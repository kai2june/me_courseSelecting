<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <title><%= title %></title>
    <script src="/js/jquery.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="/js/bootstrap.min.js"
            integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
            crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {
            $("#select option").on("click", function () {
                alert('It works');
            });
        });
    </script>

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">NCCU course system</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="/index">Home<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/curriculum">Curriculum</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/course">All courses</a>
            </li>
            <!--<li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Dropdown
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Course condition</a>
            </li> -->
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>
<!--<h1>Welcome to <%= title %></h1>-->
<!--<% for(let i = 0;i < nav.length;i++){ %>-->
<!--<li>-->
<!--<a href="<%= nav[i].link %>"><%= nav[i].title %></a>-->
<!--</li>-->
<!--<% } %>-->


<!--        <form name="queryCourseForm" id="queryCourseForm" action="/course" method="post">
            <% for(let i = 0; i < college.length; i++){ %>
                <select id="academySelect" onchange="show()">
                    <% for(let j = 0; j < college[i].length; j++){ %>
                        <option value="<%= college[i][j] %>"><%= college[i][j] %></option>
                    <% } %>
                </select>
            <% } %>
        </form>-->

<form name="queryCourseForm" id="queryCourseForm" action="/course" method="post">
    <div class="selection-div" >
        <div id="selection-div-1">
            <select name="academy" class="academySelect" onchange="showDegree()">
                <option value="none">-</option>
                <option value="integrated_general">整開_通識</option>
                <option value="minor_credited_internship">輔系_學分學程_教學實習與實務</option>
                <option value="service_PE_defenseEducation">服務學習_體育_全民國防課程</option>
                <option value="literature">文學院</option>
                <option value="science">理學院</option>
                <option value="society">社科院</option>
                <option value="law">法學院</option>
                <option value="commerce">商學院</option>
                <option value="foreign">外文學院</option>
                <option value="broadcast">傳播學院</option>
                <option value="international">國際學院</option>
                <option value="education">教育學院</option>
            </select>
            <select name="degree" class="degreeSelect" onchange="showDepartment()"></select>
            <select name="department" class="departmentSelect"></select>
        </div>
    </div>
    <button type="button" name="plus" class="plusBtn" onclick="newSelect()">+</button>
    <input type="submit" value="query">
</form>

<script>
    const college = {
        'integrated_general':{
            'integrated':['management','economics'],
            'general':['humanities','socialSciences','naturalSciences']
        },
        'minor_credited_internship':{
            'minor':['trade','accounting','japanese'],
            'credited':['creativity','patent','artIndustry'],
            'internship':['internship']
        },
        'service_PE_defenseEducation':{
            'service':['serviceCourse'],
            'PE':['PErequired','PEacquired','PEschoolTeam'],
            'defenseEducation':['defenseEducationCourse']
        },
        'society':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'law':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'commerce':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'foreign':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'broadcast':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'international':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'education':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'literature': {
            'bachelor': ['chinese','history','philosophy'],
            'master': ['chineseM','libraryInformation','religion','taiwanHistory','taiwanCulture'],
            'doctor': ['chineseTeaching']
        },
        'science': {
            'bachelor': ['psycology','mathematics','computerScience'],
            'master': ['nerve','physics','computerScienceM'],
            'doctor': ['societyAI']
        }
    };
    const value2name={"integrated_general":"整開_通識","minor_credited_internship":"輔系_學分學程_教學實習與實務",
        "service_PE_defenseEducation":"服務學習_體育_全民國防課程",
        "literature":"文學院","science":"理學院","society":"社科院","law":"法學院","commerce":"商學院",
        "foreign":"外文學院","broadcast":"傳播學院","international":"國際學院","education":"教育學院",
        "integrated":"整開","general":"通識","minor":"輔系","credited":"學分學程","internship":"教學實習與實務",
        "service":"服務","PE":"體育","defenseEducation":"國防","bachelor":"學士班","master":"碩士班","doctor":"博士班",
        "management":"管理學","economics":"經濟學","humanities":"人文通","socialSciences":"社會通","naturalSciences":"自然通",
        "trade":"貿輔","accounting":"會輔","japanese":"日輔","creativity":"創意學程","patent":"專利學程","artIndustry":"藝術產業經營學程",
        "intership":"教育實習與實務","serviceCourse":"服務學習課程","PErequired":"體育必修","PEacquired":"體育選修","PEschoolTeam":"體育代表隊",
        "defenseEducationCourse":"全民國防課程","chinese":"中文系","history":"歷史系","philosophy":"哲學系","chineseM":"中文所",
        "libraryInformation":"圖資所","religion":"宗教所","taiwanHistory":"台史所","taiwanCulture":"台文所","chineseTeaching":"華文教學博士",
        "psycology":"心理系", "mathematics":"應數系", "computerScience":"資科系", "nerve":"神經所", "physics":"應物所", "computerScienceM":"資科所", "societyAI":"社群與人智博士",
    };

    var id=1;//use to generate dynamic id

    function test() {
        for(var key in value2name)
            console.log(key+" "+value2name[key]);
    }

    $("#queryCourseForm").submit(function (event) {
        //error handling
        if(!checkIfSelect()){
            alert("Please select!!");
            event.preventDefault();
        }

    });
    function checkIfSelect(){//error handling
        for(var i=1;i<=getId();i++) {
            if ($("#selection-div-" + i + " .academySelect").val() === "none" || $("#selection-div-" + i + " .degreeSelect").val() === "none" || $("#selection-div-" + i + " .departmentSelect").val() === "none") {
                return false;
            }
        }
        return true;
    }
    function getId(){
        return id;
    }
    function newSelect() {
        if(!checkIfSelect()){
            alert("Don't be too greedy!");
            return;
        }
        id++;
        console.log("New Select Block!");
        $(".selection-div").append("<div id=\"selection-div-"+getId()+"\"></div>");
        $("#selection-div-1 .academySelect").clone().appendTo($("#selection-div-"+getId()));
        $("#selection-div-1 .degreeSelect").clone().appendTo($("#selection-div-"+getId()));
        $("#selection-div-1 .departmentSelect").clone().appendTo($("#selection-div-"+getId()));
        $("#selection-div-"+getId()).append("<button type=\"button\" name=\"remove\" class=\"removeBtn\" style=\"display: inline-block\" onclick=\"removeDiv(this)\">-</button>");
    }
    function removeDiv(btn){
        var target=$(btn).closest('div').attr('id');
        $('#'+target).remove();
    }

    function showDegree() {
        $("#selection-div-" + getId() +" .departmentSelect").html('<option value="none">-</option>');
        var academySelect=$("#selection-div-" + getId() +" .academySelect").val();
        var row=["<option value=\"none\">-</option>"];
        for(key in college[academySelect]) {
            //console.log(key);
            row += "<option value=\"" + key + "\">" + value2name[key] + "</option>";
        }
        $("#selection-div-" + getId() +" .degreeSelect").html(row);
    }

    function showDepartment() {
        var academySelect=$("#selection-div-" + getId() +" .academySelect").val();
        var degreeSelect=$("#selection-div-" + getId() +" .degreeSelect").val();
        var row=["<option value=\"none\">-</option>"];
        for(var i=0;i<college[academySelect][degreeSelect].length;i++) {
            key=college[academySelect][degreeSelect][i];
            row += "<option value=\"" + key + "\">" + value2name[key] + "</option>";
        }
        $("#selection-div-" + getId() +" .departmentSelect").html(row);
    }

</script>
</body>
</html>
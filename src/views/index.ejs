<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <title><%= title %></title>
    <script src="/js/jquery.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="/js/bootstrap.min.js"
            integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
            crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {
            $("#select option").on("click", function () {
                alert('It works');
            });
        });
    </script>

</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">NCCU course system</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="/index">Home<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/curriculum">Curriculum</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/course">All courses</a>
            </li>
            <!--<li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Dropdown
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Course condition</a>
            </li> -->
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>
<!--<h1>Welcome to <%= title %></h1>-->
<!--<% for(let i = 0;i < nav.length;i++){ %>-->
<!--<li>-->
<!--<a href="<%= nav[i].link %>"><%= nav[i].title %></a>-->
<!--</li>-->
<!--<% } %>-->


<!--        <form name="queryCourseForm" id="queryCourseForm" action="/course" method="post">
            <% for(let i = 0; i < college.length; i++){ %>
                <select id="academySelect" onchange="show()">
                    <% for(let j = 0; j < college[i].length; j++){ %>
                        <option value="<%= college[i][j] %>"><%= college[i][j] %></option>
                    <% } %>
                </select>
            <% } %>
        </form>-->

<form name="queryCourseForm" id="queryCourseForm" action="/course" method="post">
    <div class="selection-div" >
        <div id="selection-div-1">
            <select name="academy" class="academySelect" onchange="showDegree()">
                <option value="none">-</option>
                <option value="integrated_general">整開_通識</option>
                <option value="minor_credited_internship">輔系_學分學程_教學實習與實務</option>
                <option value="service_PE_defenseEducation">服務學習_體育_全民國防課程</option>
                <option value="literature">文學院</option>
                <option value="science">理學院</option>
                <option value="society">社科院</option>
                <option value="law">法學院</option>
                <option value="commerce">商學院</option>
                <option value="foreign">外文學院</option>
                <option value="broadcast">傳播學院</option>
                <option value="international">國際學院</option>
                <option value="education">教育學院</option>
            </select>
            <select name="degree" class="degreeSelect" onchange="showDepartment()"></select>
            <select name="department" class="departmentSelect"></select>
        </div>
    </div>
    <button type="button" name="plus" class="plusBtn" onclick="newSelect()">+</button>
    <input type="submit" value="query">
</form>

<script>
    const college = {
        'integrated_general':{
            'integrated':[],
            'general':[]
        },
        'minor_credited_internship':{
            'minor':[],
            'credited':[],
            'internship':[]
        },
        'service_PE_defenseEducation':{
            'service':[],
            'PE':[],
            'defenseEducation':[]
        },
        'society':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'law':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'commerce':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'foreign':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'broadcast':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'international':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'education':{
            'bachelor':[],
            'master': [],
            'doctor':[]
        },
        'literature': {
            'bachelor': ['中文系', '歷史系', '哲學系'],
            'master': ['圖資所', '宗教所', '台史所', '台文所'],
            'doctor': ['華文教學博士']
        },
        'science': {
            'bachelor': ['心理系', '應數系', '資科系'],
            'master': ['神經所', '應物所', '資科所'],
            'doctor': ['社群與人智博士']
        }
    };
    const value2name={"integrated_general":"整開_通識","minor_credited_internship":"輔系_學分學程_教學實習與實務",
        "service_PE_defenseEducation":"服務學習_體育_全民國防課程",
        "literature":"文學院","science":"理學院","society":"社科院","law":"法學院","commerce":"商學院",
        "foreign":"外文學院","broadcast":"傳播學院","international":"國際學院","education":"教育學院",
        "integrated":"整開","general":"通識","minor":"輔系","credited":"學分學程","internship":"教學實習與實務",
        "service":"服務","PE":"體育","defenseEducation":"國防","bachelor":"學士班","master":"碩士班","doctor":"博士班",
    "management":"管理學","economics":"經濟學","humanities":"人文通","socialSciences":"社會通","naturalSciences":"自然通",
    "trade":"貿輔","accounting":"會輔","japanese":"日輔","creativity":"創意學程","patent":"專利學程","artIndustry":"藝術產業經營學程",
    "intership":"教育實習與實務","service":"服務學習課程","PErequired":"體育必修","PEacquired":"體育選修","PEschoolTeam":"體育代表隊",
    "defenseEducation":"全民國防課程",
    };

    var id=1;//use to generate dynamic id

    function test() {
        for(var key in value2name)
            console.log(key+" "+value2name[key]);
    }

    $("#queryCourseForm").submit(function (event) {
        //error handling
        if(!checkIfSelect()){
            alert("Please select!!");
            event.preventDefault();
        }

    });
    function checkIfSelect(){//error handling
        for(var i=1;i<=getId();i++) {
            if ($("#selection-div-" + i + " .academySelect").val() === "none" || $("#selection-div-" + i + " .degreeSelect").val() === "none" || $("#selection-div-" + i + " .departmentSelect").val() === "none") {
                return false;
            }
        }
        return true;
    }
    function getId(){
        return id;
    }
    function newSelect() {
        if(!checkIfSelect()){
            alert("Don't be too greedy!");
            return;
        }
        id++;
        console.log("New Select Block!");
        $(".selection-div").append("<div id=\"selection-div-"+getId()+"\"></div>");
        $("#selection-div-1 .academySelect").clone().appendTo($("#selection-div-"+getId()));
        $("#selection-div-1 .degreeSelect").clone().appendTo($("#selection-div-"+getId()));
        $("#selection-div-1 .departmentSelect").clone().appendTo($("#selection-div-"+getId()));
        $("#selection-div-"+getId()).append("<button type=\"button\" name=\"remove\" class=\"removeBtn\" style=\"display: inline-block\" onclick=\"removeDiv(this)\">-</button>");
    }
    function removeDiv(btn){
        var target=$(btn).closest('div').attr('id');
        $('#'+target).remove();
    }

    function showDegree() {
        $("#selection-div-" + getId() +" .departmentSelect").html('<option value="none">-</option>');
        var academySelect=$("#selection-div-" + getId() +" .academySelect").val();
        var row=["<option value=\"none\">-</option>"];
        for(key in college[academySelect]) {
            //console.log(key);
            row += "<option value=\"" + key + "\">" + value2name[key] + "</option>";
        }
        $("#selection-div-" + getId() +" .degreeSelect").html(row);
    }

    function showDepartment() {
        switch ($(".academySelect").val()) {
            case 'integrated_general':
                showDepartmentIntegratedGeneral();
                break;
            case 'minor_credited_internship':
                showDepartmentMinorCreditedInternship();
                break;
            case 'service_PE_defenseEducation':
                showDepartmentServicePEDefenseEducation();
                break;
            case 'literature':
                showDepartmentLiterature();
                break;
            case 'science':
                showDepartmentScience();
                break;
        }
    }

    function showDepartmentIntegratedGeneral() {
        switch ($(".degreeSelect").val()) {
            case 'integrated':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="management">管理學</option>\
                        <option value="economics">經濟學</option>');
                break;
            case 'general':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="humanities">人文通</option>\
                        <option value="socialSciences">社會通</option>\
                        <option value="naturalSciences">自然通</option>');
                break;
        }
    };

    function showDepartmentMinorCreditedInternship() {
        switch ($(".degreeSelect").val()) {
            case 'minor':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="trade">貿輔</option>\
                        <option value="accounting">會輔</option>\
                        <option value="japanese">日輔</option>');
                break;
            case 'credited':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="creativity">創意學程</option>\
                        <option value="patent">專利學程</option>\
                        <option value="artIndustry">藝術產業經營學程</option>');
                break;
            case 'internship':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="intership">教育實習與實務</option>');
                break;
        }
    };

    function showDepartmentServicePEDefenseEducation() {
        switch ($(".degreeSelect").val()) {
            case 'service':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="service">服務學習課程</option>');
                break;
            case 'PE':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="PErequired">體育必修</option>\
                        <option value="PEacquired">體育選修</option>\
                        <option value="PEschoolTeam">體育代表隊</option>');
                break;
            case 'defenseEducation':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="defenseEducation">全民國防課程</option>');
                break;
        }
    };

    function showDepartmentLiterature() {
        switch ($(".degreeSelect").val()) {
            case 'bachelor':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="chinese">中文系</option>\
                        <option value="history">歷史系</option>\
                        <option value="philosophy">哲學系</option>');
                break;
            case 'master':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="chinese">中文所</option>\
                        <option value="libraryInformation">圖資所</option>\
                        <option value="religion">宗教所</option>\
                        <option value="taiwanHistory">台史所</option>\
                        <option value="taiwanCulture">台文所</option>');
                break;
            case 'doctor':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="chineseTeaching">華文教學博士</option>');
                break;
        }
    }

    function showDepartmentScience() {
        switch ($(".degreeSelect").val()) {
            case 'bachelor':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="psycology">心理系</option>\
                        <option value="mathematics">應數系</option>\
                        <option value="computerScience">資科系</option>');
                break;
            case 'master':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="nerve">神經所</option>\
                        <option value="physics">應物所</option>\
                        <option value="computerScience">資科所</option>');
                break;
            case 'doctor':
                $(".departmentSelect").html('\
                        <option value="none">-</option>\
                        <option value="societyAI">社群與人智博士</option>');
                break;
        }
    }

</script>
</body>
</html>